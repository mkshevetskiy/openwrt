From 13a46ffeea9aec38986a101a227eb44e2610e563 Mon Sep 17 00:00:00 2001
Message-ID: <13a46ffeea9aec38986a101a227eb44e2610e563.1753790487.git.lorenzo@kernel.org>
In-Reply-To: <00275548ba8f8ff8da354e44dd25b329e84924f4.1753790487.git.lorenzo@kernel.org>
References: <00275548ba8f8ff8da354e44dd25b329e84924f4.1753790487.git.lorenzo@kernel.org>
From: Lorenzo Bianconi <lorenzo@kernel.org>
Date: Mon, 14 Jul 2025 13:57:57 +0200
Subject: [PATCH 19/24] wifi: mt76: Add mt76_dev pointer in mt76_queue struct.

This is a preliminary patch to enable traffic forward offloading via the
Airoha NPU module available on the Airoha EN7581 SoC.

Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
---
 dma.c  | 1 +
 mt76.h | 1 +
 2 files changed, 2 insertions(+)

diff --git a/dma.c b/dma.c
index b6e0274f..b79cf0af 100644
--- a/dma.c
+++ b/dma.c
@@ -750,6 +750,7 @@ mt76_dma_alloc_queue(struct mt76_dev *dev, struct mt76_queue *q,
 	q->ndesc = n_desc;
 	q->buf_size = bufsize;
 	q->hw_idx = idx;
+	q->dev = dev;
 
 	size = mt76_queue_is_wed_rro_ind(q) ? sizeof(struct mt76_wed_rro_desc)
 					    : sizeof(struct mt76_desc);
diff --git a/mt76.h b/mt76.h
index dadbb04b..e75cc886 100644
--- a/mt76.h
+++ b/mt76.h
@@ -252,6 +252,7 @@ struct mt76_queue {
 	__le16 *emi_cpu_idx;
 
 	struct mtk_wed_device *wed;
+	struct mt76_dev *dev;
 	u32 wed_regs;
 
 	dma_addr_t desc_dma;
-- 
2.50.1

